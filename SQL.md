# SQL statements used to initialize database tables

```
CREATE TABLE "USER"(
    UID        SERIAL      PRIMARY KEY,
    USERNAME   VARCHAR(20) UNIQUE NOT NULL,
    PASSWORD   VARCHAR(32) NOT NULL,
    ISADMIN    BOOL        DEFAULT false NOT NULL,
    ISVERIFIED BOOL        DEFAULT true NOT NULL
);

CREATE TABLE ERA(
    EID     integer     AUTO_INCREMENT PRIMARY KEY,
    ERANAME varchar(20) UNIQUE NOT NULL
);  

CREATE TABLE CNDTN(
    CNID      integer     AUTO_INCREMENT PRIMARY KEY,
    CNDTNNAME varchar(20) UNIQUE NOT NULL
);

CREATE TABLE DIMENSION(
    DID           integer     AUTO_INCREMENT PRIMARY KEY,
    DIMENSIONNAME varchar(20) UNIQUE NOT NULL
);

CREATE TABLE SIZE(
    SID      integer     AUTO_INCREMENT PRIMARY KEY,
    SIZENAME varchar(20) UNIQUE NOT NULL
);

CREATE TABLE OBJECT(
    OID          integer        AUTO_INCREMENT PRIMARY KEY,
    OBJECTNAME   varchar(45)    NOT NULL,
    DESCRIPTION  varchar(400),
    TYPE         enum('c', 'p') NOT NULL,
    CNID         integer,
    EID          integer,
    CHECKEDOUTTO integer,
    FOREIGN KEY (EID) REFERENCES ERA(EID) ON UPDATE CASCADE ON DELETE SET NULL,
    FOREIGN KEY (CNID) REFERENCES CNDTN(CNID) ON UPDATE CASCADE ON DELETE SET NULL,
    FOREIGN KEY (CHECKEDOUTTO) REFERENCES USER(UID) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE COSTUME(
    OID  integer PRIMARY KEY,
    SID  integer NOT NULL,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (SID) REFERENCES SIZE(SID) ON UPDATE CASCADE
);

CREATE TABLE PROP(
    OID integer PRIMARY KEY,
    DID integer NOT NULL,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (DID) REFERENCES DIMENSION(DID) ON UPDATE CASCADE
);

CREATE TABLE AUDITACTION(
    AAID            integer     AUTO_INCREMENT PRIMARY KEY,
    AUDITACTIONNAME varchar(20) UNIQUE NOT NULL
);

CREATE TABLE AUDIT(
    AID  integer  AUTO_INCREMENT PRIMARY KEY,
    AAID integer  NOT NULL,
    TIME DATETIME NOT NULL,
    OID  integer,
    UID  integer,
    FOREIGN KEY (AAID) REFERENCES AUDITACTION(AAID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (UID) REFERENCES USER(UID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE PICTURE(
    PID integer AUTO_INCREMENT PRIMARY KEY,
    OID integer NOT NULL,
    IMAGE VARCHAR(100) NOT NULL,
    OBJORDER integer NOT NULL,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE COLOR(
    CID integer AUTO_INCREMENT PRIMARY KEY,
    COLORNAME varchar(20) UNIQUE NOT NULL
);

CREATE TABLE OBJECTCOLOR(
    OID integer,
    CID integer,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (CID) REFERENCES COLOR(CID) ON UPDATE CASCADE ON DELETE CASCADE,
    PRIMARY KEY(OID, CID)
);
```

# SQL statements used to add test data to database

```
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Login");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Create Account");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Add Object");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Modify Object");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Delete Object");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Checkout Object");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Checkin Object");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Approve User");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Add Era");
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ("Add Color");

INSERT INTO ERA(EID, ERANAME) VALUES (1, "Medieval");
INSERT INTO ERA(EID, ERANAME) VALUES (2, "Edo");
INSERT INTO ERA(EID, ERANAME) VALUES (3, "Modern");

INSERT INTO CNDTN(CNID, CNDTNNAME) VALUES (1, "New");
INSERT INTO CNDTN(CNID, CNDTNNAME) VALUES (2, "Excellent");
INSERT INTO CNDTN(CNID, CNDTNNAME) VALUES (3, "Good");
INSERT INTO CNDTN(CNID, CNDTNNAME) VALUES (4, "Decent");
INSERT INTO CNDTN(CNID, CNDTNNAME) VALUES (5, "Bad");
INSERT INTO CNDTN(CNID, CNDTNNAME) VALUES (6, "Unusable");

INSERT INTO DIMENSION(DID, DIMENSIONNAME) VALUES (1, "Small");
INSERT INTO DIMENSION(DID, DIMENSIONNAME) VALUES (2, "Medium");
INSERT INTO DIMENSION(DID, DIMENSIONNAME) VALUES (3, "Big");

INSERT INTO SIZE (SID, SIZENAME) VALUES (1, "XS");
INSERT INTO SIZE (SID, SIZENAME) VALUES (2, "S");
INSERT INTO SIZE (SID, SIZENAME) VALUES (3, "M");
INSERT INTO SIZE (SID, SIZENAME) VALUES (4, "L");
INSERT INTO SIZE (SID, SIZENAME) VALUES (5, "XL");
INSERT INTO SIZE (SID, SIZENAME) VALUES (6, "2XL");
INSERT INTO SIZE (SID, SIZENAME) VALUES (7, "3XL");

INSERT INTO COLOR(CID, COLORNAME) VALUES (1, "Gold");
INSERT INTO COLOR(CID, COLORNAME) VALUES (2, "Gray");
INSERT INTO COLOR(CID, COLORNAME) VALUES (3, "Red");
INSERT INTO COLOR(CID, COLORNAME) VALUES (4, "Yellow");
INSERT INTO COLOR(CID, COLORNAME) VALUES (5, "Brown");

INSERT INTO USER(USERNAME, PASSWORD) VALUES ("user", "user");
INSERT INTO USER(USERNAME, PASSWORD, ISADMIN) VALUES ("admin", "admin", 1);

INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (1, "Crown", "Shiny, pointy, and goes on head", 'c', 3, 1);
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (2, "Broadsword", "A big sword for swinging around", 'p', 5, 1);
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (3, "Katana", "For when just wearing all black doesn't make you NINJA enough", 'p', 2, 2);
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (4, "Cape", "NO CAPES!", 'c', 2, 3);
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (5, "Sunglasses", "For blocking bright lights or just to look cool", 'c', 3, 3);
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (6, "Trebuchet", "To launch Pumpkin Kid aerially into your enemies", 'p', 5, 1);
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID, CHECKEDOUTTO) VALUES (7, "Costume1", "test for checkedoutto", 'c', 2, 3, 1);

INSERT INTO OBJECTCOLOR(OID, CID) VALUES (1, 1);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (2, 2);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (3, 2);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (4, 3);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (5, 4);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (6, 5);

INSERT INTO COSTUME(OID, SID) VALUES (1, 4);
INSERT INTO COSTUME(OID, SID) VALUES (4, 2);
INSERT INTO COSTUME(OID, SID) VALUES (5, 7);

INSERT INTO PROP(OID, DID) VALUES (2, 1);
INSERT INTO PROP(OID, DID) VALUES (3, 2);
INSERT INTO PROP(OID, DID) VALUES (6, 3);

INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (1, 1, 'Crown.jpg', 1);
INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (2, 2, 'broadsword.jpg', 1);
INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (3, 3, 'katana.jpg', 1);
INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (4, 4, 'cape.jpeg', 1);
INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (5, 5, 'sunglasses.jpg', 1);
INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (6, 6, 'Trebuchet.jpg', 1);
INSERT INTO PICTURE (PID, OID, IMAGE, OBJORDER) VALUES (7, 7, â€˜treb1.jpg', 1);

```
# Application Queries
Login Query
```
SELECT UID FROM USER WHERE NAME = $name$ AND PASSWORD = $password$ AND ISVERIFIED = 1;
```
User Registration Query
```
INSERT INTO USER(NAME, PASSWORD) VALUES ($name$, $password$);
```
Admin Registration Query
```
INSERT INTO USER(NAME, PASSWORD, ISADMIN) VALUES ($name$, $password$, 1);
```
Search Query (with filters)
```
SELECT * FROM OBJECT WHERE NAME = $searchName$ [AND TYPE = 'c' | AND TYPE = 'p'] [AND CNDTN = 'New' | AND CNDTN = 'Good' | AND CNDTN = 'Decent' | AND CNDTN = 'Excellent' | AND CNDTN = 'Bad' | AND CNDTN = 'Unusable'] [AND ERA = $era$] [AND NOT (CHECKEDOUTTO = NULL)];
```
Edit Object Query
```
UPDATE OBJECT SET [TYPE = 'c' | TYPE = 'p'] [CNDTN = 'New' | CNDTN = 'Good' | CNDTN = 'Decent' | CNDTN = 'Excellent' | CNDTN = 'Bad' | CNDTN = 'Unusable'] [ERA = $era$] [CHECKOUTTO = $uid$] WHERE OID = $objID$;
```
Add Picture Query
```
INSERT INTO PICTURE(OID, IMAGE) VALUES ($oid$, $imageBlob$);
```
View Logs
```
SELECT * FROM AUDIT WHERE [ACTION = $auditaction$] [OBJECT = $oid$] [USER = $uid$];
```
Remove Object
```
DELETE FROM OBJECT WHERE OID = $oid$;
```
Remove User
```
DELETE FROM USER WHERE UID = $uid$;
```
Get Objects and its pictures
```
SELECT * FROM OBJECT NATURAL JOIN PICTURE
```
Queries for buildCreate (finding IDs needs to be done before buildCreate call)
```
#Find max OID (you'll need to add 1 to the result):
SELECT MAX(OID) AS OID FROM OBJECT;
#Find CNID:
SELECT CNID FROM CNDTN WHERE CNDTNNAME = 'string';
#Find EID:
SELECT EID FROM ERA WHERE ERANAME = 'string';
#Find SID:
SELECT SID FROM SIZE WHERE SIZENAME = 'string';
#Find DID:
SELECT DID FROM DIMENSION WHERE DIMENSIONNAME = 'string';
#Find CID:
SELECT CID FROM COLOR WHERE COLORNAME = 'string';
#Insert OBJECT:
INSERT INTO OBJECT(OID, OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES (oid, 'objectname', 'description', 'type', cnid, eid);
#Insert COSTUME (run only for type = 'c'):
INSERT INTO COSTUME(OID, SID) VALUES (oid, sid);
#Insert PROP (run only for type = 'p'):
INSERT INTO PROP(OID, DID) VALUES (oid, did);
#Insert COLOR (run once per color adding to the object):
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (oid, cid);
```
