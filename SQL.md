# SQL statements used to initialize database tables

```
CREATE TABLE ACCOUNT(
    UID        SERIAL      PRIMARY KEY,
    USERNAME   VARCHAR(20) UNIQUE NOT NULL,
    PASSWORD   VARCHAR(32) NOT NULL,
    FIRSTNAME  VARCHAR(20) NOT NULL,
    LASTNAME   VARCHAR(20) NOT NULL,
    ISADMIN    BOOL        DEFAULT false NOT NULL,
    ISVERIFIED BOOL        DEFAULT true NOT NULL
);

CREATE TABLE ERA(
    EID     SERIAL         PRIMARY KEY,
    ERANAME VARCHAR(20)    UNIQUE NOT NULL
);  

CREATE TABLE CNDTN(
    CNID      SERIAL      PRIMARY KEY,
    CNDTNNAME VARCHAR(20) UNIQUE NOT NULL
);

CREATE TYPE objtype AS ENUM ('c', 'p');

CREATE TABLE OBJECT(
    OID          SERIAL         PRIMARY KEY,
    OBJECTNAME   VARCHAR(45)    NOT NULL,
    DESCRIPTION  VARCHAR(400),
    TYPE         objtype NOT NULL,
    SIZE         VARCHAR(20),
    CNID         INTEGER,
    EID          INTEGER,
    CHECKEDOUTTO INTEGER,
    FOREIGN KEY (EID) REFERENCES ERA(EID) ON UPDATE CASCADE ON DELETE SET NULL,
    FOREIGN KEY (CNID) REFERENCES CNDTN(CNID) ON UPDATE CASCADE ON DELETE SET NULL,
    FOREIGN KEY (CHECKEDOUTTO) REFERENCES ACCOUNT(UID) ON UPDATE CASCADE ON DELETE SET NULL
);


CREATE TABLE AUDITACTION(
    AAID            SERIAL      PRIMARY KEY,
    AUDITACTIONNAME VARCHAR(20) UNIQUE NOT NULL
);

CREATE TABLE AUDIT(
    AID  SERIAL   PRIMARY KEY,
    AAID INTEGER  NOT NULL,
    TIME timestamp NOT NULL,
    OID  INTEGER,
    UID  INTEGER,
    FOREIGN KEY (AAID) REFERENCES AUDITACTION(AAID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (UID) REFERENCES ACCOUNT(UID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE PICTURE(
    PID SERIAL     PRIMARY KEY,
    OID INTEGER    NOT NULL,
    IMAGE VARCHAR(100) NOT NULL,
    OBJORDER INTEGER NOT NULL,
    UNIQUE(OID, OBJORDER),
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE COLOR(
    CID SERIAL PRIMARY KEY,
    COLORNAME VARCHAR(20) UNIQUE NOT NULL
);

CREATE TABLE OBJECTCOLOR(
    OID integer,
    CID integer,
    FOREIGN KEY (OID) REFERENCES OBJECT(OID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (CID) REFERENCES COLOR(CID) ON UPDATE CASCADE ON DELETE CASCADE,
    PRIMARY KEY(OID, CID)
);
```

# SQL statements used to add test data to database

```
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Login');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Create Account');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Add Object');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Modify Object');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Delete Object');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Checkout Object');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Checkin Object');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Approve User');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Add Era');
INSERT INTO AUDITACTION(AUDITACTIONNAME) VALUES ('Add Color');

INSERT INTO ERA(ERANAME) VALUES ('Medieval');
INSERT INTO ERA(ERANAME) VALUES ('Edo');
INSERT INTO ERA(ERANAME) VALUES ('Modern');

INSERT INTO CNDTN(CNDTNNAME) VALUES ('New');
INSERT INTO CNDTN(CNDTNNAME) VALUES ('Excellent');
INSERT INTO CNDTN(CNDTNNAME) VALUES ('Good');
INSERT INTO CNDTN(CNDTNNAME) VALUES ('Decent');
INSERT INTO CNDTN(CNDTNNAME) VALUES ('Bad');
INSERT INTO CNDTN(CNDTNNAME) VALUES ('Unusable');

INSERT INTO COLOR(COLORNAME) VALUES ('Gold');
INSERT INTO COLOR(COLORNAME) VALUES ('Gray');
INSERT INTO COLOR(COLORNAME) VALUES ('Red');
INSERT INTO COLOR(COLORNAME) VALUES ('Yellow');
INSERT INTO COLOR(COLORNAME) VALUES ('Brown');

INSERT INTO ACCOUNT(USERNAME, PASSWORD, FIRSTNAME, LASTNAME) VALUES ('user', 'user', 'user', 'user');
INSERT INTO ACCOUNT(USERNAME, PASSWORD, FIRSTNAME, LASTNAME, ISADMIN) VALUES ('admin', 'admin', 'admin', 'admin', true);

INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES ('Crown', 'Shiny, pointy, and goes on head', 'c', 3, 1);
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES ('Broadsword', 'A big sword for swinging around', 'p', 5, 1);
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES ('Katana', 'For when just wearing all black doesn\'t make you NINJA enough', 'p', 2, 2);
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES ('Cape', 'NO CAPES!', 'c', 2, 3);
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES ('Sunglasses', 'For blocking bright lights or just to look cool', 'c', 3, 3);
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID) VALUES ('Trebuchet', 'To launch Pumpkin Kid aerially into your enemies', 'p', 5, 1);
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, CNID, EID, CHECKEDOUTTO) VALUES ('Costume1', 'test for checkedoutto', 'c', 2, 3, 1);

INSERT INTO OBJECTCOLOR(OID, CID) VALUES (1, 1);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (2, 2);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (3, 2);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (4, 3);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (5, 4);
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (6, 5);

INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (1, 'Crown.jpg', 1);
INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (2, 'broadsword.jpg', 1);
INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (3, 'katana.jpg', 1);
INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (4, 'cape.jpeg', 1);
INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (5, 'sunglasses.jpg', 1);
INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (6, 'Trebuchet.jpg', 1);
INSERT INTO PICTURE (OID, IMAGE, OBJORDER) VALUES (7, â€˜treb1.jpg', 1);

```
# Application Queries
Login Query
```
SELECT UID FROM ACCOUNT WHERE NAME = '$name$' AND PASSWORD = '$password$' AND ISVERIFIED = true;
```
User Registration Query
```
INSERT INTO ACCOUNT(NAME, PASSWORD, FIRSTNAME, LASTNAME) VALUES ($name$, $password$, $firstname$, $lastname$);
```
Admin Registration Query
```
INSERT INTO ACCOUNT(NAME, PASSWORD, ISADMIN, FIRSTNAME, LASTNAME) VALUES ($name$, $password$, true, $firstname$, $lastname$);
```
Add Picture Query
```
INSERT INTO PICTURE(OID, IMAGE, OBJORDER) VALUES ($oid$, $imageBlob$, $ordervalue$);
```
View Logs
```
SELECT * FROM AUDIT WHERE [ACTION = $auditaction$] [OBJECT = $oid$] [USER = $uid$];
```
Remove Object
```
DELETE FROM OBJECT WHERE OID = $oid$;
```
Remove User
```
DELETE FROM ACCOUNT WHERE UID = $uid$;
```
Get Objects and its pictures
```
SELECT * FROM OBJECT NATURAL JOIN PICTURE
```
Queries for buildCreate (finding IDs needs to be done before buildCreate call)
```
#Find CNID:
SELECT CNID FROM CNDTN WHERE CNDTNNAME = '$condition$';
#Find EID:
SELECT EID FROM ERA WHERE ERANAME = '$era$';
#Find CID:
SELECT CID FROM COLOR WHERE COLORNAME = '$color$';
#Insert OBJECT:
INSERT INTO OBJECT(OBJECTNAME, DESCRIPTION, TYPE, SIZE, CNID, EID) VALUES ('$objectname$', '$description$', '$type$', '$size$', cnid, eid);
#Insert COLOR (run once per color adding to the object):
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (oid, cid);
#Insert PICTURE: (order should start at 1 for the first picture, and be incremented for subsequent pictures)
INSERT INTO PICTURE(OID, IMAGE, OBJORDER) VALUES (oid, '$image$', order);
```
Queries for buildUpdate:
```
#Find CNID:
SELECT CNID FROM CNDTN WHERE CNDTNNAME = '$condition$';
#Find EID:
SELECT EID FROM ERA WHERE ERANAME = '$era$';
#Find CID:
SELECT CID FROM COLOR WHERE COLORNAME = 'string';
#Get highest OBJORDER for an OBJECT:
SELECT MAX(OBJORDER) AS OBJORDER FROM PICTURE WHERE OID = oid;
#Update an object (clauses in SET can be excluded as needed):
UPDATE OBJECT SET OBJECTNAME = '$objectname$', DESCRIPTION = '$description$', TYPE = '$type$', SIZE = '$size$', CNID = cnid, EID = eid WHERE OID = oid;
#Remove a color:
DELETE FROM OBJECTCOLOR WHERE OID = oid AND CID = cid;
#Add a new color:
INSERT INTO OBJECTCOLOR(OID, CID) VALUES (oid, cid);
#Add new PICTURE: (be sure and increment order)
INSERT INTO PICTURE(OID, IMAGE, OBJORDER) VALUES (oid, 'image', order);
#Delete a PICTURE:
DELETE FROM PICTURE WHERE OID = oid AND OBJORDER = order;
or
DELETE FROM PICTURE WHERE IMAGE = 'image';
```
Queries for delete: (everything else cascades)
```
DELETE FROM OBJECT WHERE OID = oid;
```
